define(["jquery"],function(a){function b(b,c,d){a("#block_samieattendance_toggleUserAttendance"+b).attr("src",M.cfg.wwwroot+"/blocks/samieattendance/pix/"+c+".png").attr("value",c);var e=parseInt(a("#studentAttendance"+b).val());a("#studentAttendance"+b).val(e+d);var f=parseInt(a("#courseCountAttendance").val()),g=100*(e+d)/f;a("#percentage"+b).text(g.toFixed(2)+" %")}function c(c,d,e,g){a.ajax({url:M.cfg.wwwroot+"/blocks/samieattendance/requests.php",type:"POST",async:!0,data:{action:c,alu_id:e,course_id:d,asi_fecha:g},success:function(a){try{if("OK"==a)if(e==f&&"setAttendance"==c)window.location=window.location,location.reload(!0);else{var d="setAttendance"==c?1:-1,g="setAttendance"==c?"ok":"fail";b(e,g,d)}return}catch(a){}},error:function(){}})}function d(b,c,d){window.confirm(b)&&a.ajax({url:M.cfg.wwwroot+"/blocks/samieattendance/requests.php",type:"POST",async:!0,data:{action:"resetAttendance",course_id:c,asi_fecha:d},success:function(a){try{return void("OK"==a?(window.location=window.location,location.reload(!0)):window.alert("Error reseting roll call"))}catch(a){}},error:function(){}})}function e(b,d,e){var f="setAttendance";"ok"==a("#block_samieattendance_toggleUserAttendance"+d).attr("value")&&(f="delAttendance"),c(f,b,d,e)}var f=-1;return{reset_attendance:d,toggle_samie_user_attendance:c,toggle_user_attendance:e,init:function(a){f=a}}});